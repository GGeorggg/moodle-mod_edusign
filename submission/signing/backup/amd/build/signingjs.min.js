function getPosition(a,b){var c=b.getBoundingClientRect();return console.log(a.clientX+" "+c.left+" "+c.right+" "+a.offsetX+" "+c.left+" "+b.offsetLeft),{X:a.offsetX,Y:a.offsetY}}function initialize(){function a(a){var c={x:mouseEvent.offsetX,y:mouseEvent.offsetX},d=b;if(d.offsetParent)do c.x-=d.offsetLeft,c.y-=d.offsetTop;while(null!=(d=d.offsetParent));e[a.type](c)}var b=document.getElementById("canvas"),c=b.getContext("2d");c.strokeStyle="#000",c.lineJoin="round",c.lineWidth=10,$("#clearCanvas").bind("click",function(){clearCanvas(b,c)}),$("#id_submitbutton").click(function(){var a=$("#canvas")[0].toDataURL();$("#id_signing").val(a)});var d="ontouchstart"in document.documentElement;if(d){var e={isDrawing:!1,touchstart:function(a){c.beginPath(),c.moveTo(a.x,a.y),this.isDrawing=!0},touchmove:function(a){this.isDrawing&&(c.lineTo(a.x,a.y),c.stroke())},touchend:function(a){this.isDrawing&&(this.touchmove(a),this.isDrawing=!1)}};b.addEventListener("touchstart",a,!1),b.addEventListener("touchmove",a,!1),b.addEventListener("touchend",a,!1),b.addEventListener("touchmove",function(a){a.preventDefault()},!1)}else $("#canvas").mousedown(function(a){var d=getPosition(a,b);c.moveTo(d.X,d.Y),c.beginPath(),$(this).mousemove(function(a){drawLine(a,b,c)}).mouseup(function(a){finishDrawing(a,b,c)}).mouseout(function(a){finishDrawing(a,b,c)})})}function drawLine(a,b,c){var d=getPosition(a,b);c.lineTo(d.X,d.Y),c.stroke()}function finishDrawing(a,b,c){drawLine(a,b,c),c.closePath(),$(b).unbind("mousemove").unbind("mouseup").unbind("mouseout")}function clearCanvas(a,b){b.clearRect(0,0,a.width,a.height)}function downloadCanvas(a){this.href=a.toDataURL()}function save(){this.href=canvas.toDataURL(),$("#signing").val("this.href")}define(["jquery"],function(a){return{init:function(){initialize()},save:function(){initialize()}}});